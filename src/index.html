<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Flechazo TV</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* --- ESTILOS BASE --- */
        :root { 
            --bg-dark: #000000; /* Fondo más negro tipo Netflix/ReelShort */
            --bg-card: #141414;
            --text: #ffffff; 
            --primary: #ff3366;
            --gold: #ffd700;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; -webkit-tap-highlight-color: transparent; }
        
        body { 
            background-color: var(--bg-dark); 
            color: var(--text); 
            padding-bottom: 80px; 
            overflow-x: hidden;
        }

        /* --- IMÁGENES AUTOAJUSTABLES (CORE) --- */
        img { display: block; max-width: 100%; height: auto; }

        /* --- HEADER --- */
        .header { 
            padding: 15px 20px; display: flex; align-items: center; justify-content: space-between; 
            position: sticky; top: 0; z-index: 50; 
            background: linear-gradient(to bottom, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0) 100%);
        }
        .logo-text { font-size: 1.4rem; font-weight: 800; color: var(--primary); letter-spacing: -1px; text-transform: uppercase; }
        
        /* --- HERO (Banner Principal) --- */
        .hero-container { position: relative; width: 100%; height: 500px; margin-bottom: 20px; }
        .hero-img { 
            width: 100%; height: 100%; object-fit: cover; 
            mask-image: linear-gradient(to bottom, black 70%, transparent 100%);
            -webkit-mask-image: linear-gradient(to bottom, black 70%, transparent 100%);
        }
        .hero-content { 
            position: absolute; bottom: 0; left: 0; width: 100%; padding: 20px; text-align: center;
            display: flex; flex-direction: column; align-items: center;
        }
        .hero-tags { font-size: 0.8rem; color: #ccc; margin-bottom: 15px; display: flex; gap: 10px; }
        .hero-btns { display: flex; gap: 15px; width: 100%; justify-content: center; }
        .btn { padding: 8px 25px; border-radius: 4px; font-weight: bold; border: none; display: flex; align-items: center; gap: 8px; font-size: 1rem; cursor: pointer; }
        .btn-white { background: white; color: black; }
        .btn-trans { background: rgba(255,255,255,0.2); color: white; backdrop-filter: blur(5px); }

        /* --- RANKING SLIDER (1, 2, 3...) --- */
        .section-title { padding: 0 20px; margin: 10px 0; font-size: 1.1rem; font-weight: 700; }
        .slider { display: flex; gap: 15px; overflow-x: auto; padding: 10px 20px; scrollbar-width: none; align-items: center; }
        
        .rank-card { 
            position: relative; min-width: 140px; height: 180px; 
            display: flex; align-items: flex-end; cursor: pointer;
            margin-right: 10px; /* Espacio extra para el numero */
        }
        /* El número gigante SVG o CSS */
        .rank-number {
            font-size: 110px; font-weight: 900; line-height: 80px;
            position: absolute; left: -15px; bottom: 0; z-index: 2;
            color: black;
            -webkit-text-stroke: 4px #5e5e5e; /* Borde gris */
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            font-family: 'Arial Black', sans-serif;
        }
        /* La imagen desplazada */
        .rank-img { 
            width: 110px; height: 160px; object-fit: cover; border-radius: 8px; 
            margin-left: 30px; /* Deja espacio para el número */
            z-index: 1; box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        }

        /* --- STANDARD CARD --- */
        .poster-card { min-width: 110px; cursor: pointer; }
        .poster-img { 
            width: 110px; aspect-ratio: 2/3; /* Autoajuste perfecto */
            border-radius: 6px; object-fit: cover; background: #222; 
        }

        /* --- TABS & CONTENT --- */
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.4s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* --- GRID EXPLORAR --- */
        .grid-container {
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; padding: 15px;
        }
        .grid-img { width: 100%; aspect-ratio: 2/3; object-fit: cover; border-radius: 6px; background: #222; }

        /* --- SECCIÓN PREMIUM (REEMPLAZA PERFIL) --- */
        .premium-header {
            background: linear-gradient(180deg, #1e1e24 0%, #000 100%);
            padding: 40px 20px; text-align: center; border-bottom: 1px solid #333;
        }
        .vip-card {
            background: linear-gradient(135deg, #ffd700 0%, #b8860b 100%);
            color: black; padding: 20px; border-radius: 15px; margin: 20px 0;
            box-shadow: 0 5px 20px rgba(255, 215, 0, 0.3);
        }
        .coin-store { padding: 20px; }
        .coin-item {
            display: flex; justify-content: space-between; align-items: center;
            background: #1a1a1a; padding: 15px; border-radius: 10px; margin-bottom: 10px; border: 1px solid #333;
        }
        .coin-price { background: var(--text); color: black; padding: 5px 15px; border-radius: 20px; font-weight: bold; }

        /* --- BOTTOM NAV --- */
        .bottom-nav { 
            position: fixed; bottom: 0; left: 0; width: 100%; height: 65px; 
            background: #121212; border-top: 1px solid #333;
            display: flex; justify-content: space-around; align-items: center; z-index: 100;
        }
        .nav-item { color: #555; font-size: 0.7rem; text-align: center; cursor: pointer; flex: 1; }
        .nav-item i { font-size: 1.4rem; display: block; margin-bottom: 4px; }
        .nav-item.active { color: white; }

        /* --- SEARCH MODAL --- */
        .search-modal { position: fixed; inset: 0; background: #000; z-index: 200; display: none; padding: 20px; }
        .search-modal.active { display: block; }
        .search-bar { width: 100%; background: #222; border: none; padding: 15px; border-radius: 8px; color: white; font-size: 1.1rem; outline: none; }

        /* --- SHEET INFO --- */
        .sheet-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 150; display: none; }
        .sheet-overlay.active { display: block; }
        .bottom-sheet { 
            position: fixed; bottom: 0; left: 0; width: 100%; max-height: 80vh; background: #161616; 
            border-radius: 20px 20px 0 0; z-index: 160; transform: translateY(100%); transition: transform 0.3s; 
            overflow-y: auto; padding: 20px;
        }
        .bottom-sheet.active { transform: translateY(0); }
    </style>
</head>
<body>

    <header class="header">
        <div class="logo-text">FLECHAZO TV</div>
        <div>
            <i class="fa-solid fa-search" style="font-size: 1.2rem; color: white; margin-right: 15px;" onclick="toggleSearch(true)"></i>
            <i class="fa-solid fa-crown" style="font-size: 1.2rem; color: var(--gold);" onclick="switchTab('premium')"></i>
        </div>
    </header>

    <div id="tab-home" class="tab-content active">
        <div id="heroContainer" class="hero-container">
            </div>

        <div class="section-title">Las 10 series más vistas hoy</div>
        <div class="slider" id="rankingSlider">
            </div>

        <div class="section-title">Nuevos Lanzamientos</div>
        <div class="slider" id="newSlider"></div>
    </div>

    <div id="tab-explore" class="tab-content">
        <div class="section-title" style="padding-top:20px;">Catálogo Completo</div>
        <div id="exploreGrid" class="grid-container"></div>
    </div>

    <div id="tab-mylist" class="tab-content">
        <div class="section-title" style="padding-top:20px;">Mi Lista</div>
        <div id="myListGrid" class="grid-container">
            <p style="color:#555; padding:20px;">Aún no tienes series guardadas.</p>
        </div>
    </div>

    <div id="tab-premium" class="tab-content">
        <div class="premium-header">
            <h1 style="font-size:1.5rem;">Tienda VIP</h1>
            <p style="color:#888; font-size:0.9rem; margin-top:5px;">Desbloquea todos los episodios</p>
            
            <div class="vip-card">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <div style="text-align:left;">
                        <h2 style="font-size:1.4rem; font-weight:900;">GOLD VIP</h2>
                        <p style="font-size:0.8rem;">Sin anuncios • 4K UHD</p>
                    </div>
                    <i class="fa-solid fa-gem" style="font-size:2rem;"></i>
                </div>
            </div>
            
            <div style="display:flex; gap:20px; justify-content:center; margin-top:20px;">
                <div style="text-align:center;">
                    <div style="font-size:1.2rem; font-weight:bold; color:white;">0</div>
                    <div style="font-size:0.7rem; color:#666;">Monedas</div>
                </div>
                <div style="text-align:center;">
                    <div style="font-size:1.2rem; font-weight:bold; color:white;">0</div>
                    <div style="font-size:0.7rem; color:#666;">Cupones</div>
                </div>
            </div>
        </div>

        <div class="coin-store">
            <div class="section-title">Recargar Monedas</div>
            
            <div class="coin-item">
                <div style="display:flex; gap:10px; align-items:center;">
                    <i class="fa-solid fa-coins" style="color:var(--gold);"></i>
                    <span>100 Monedas + 10 Bonus</span>
                </div>
                <div class="coin-price">S/ 3.90</div>
            </div>
            <div class="coin-item">
                <div style="display:flex; gap:10px; align-items:center;">
                    <i class="fa-solid fa-coins" style="color:var(--gold);"></i>
                    <span>500 Monedas + 100 Bonus</span>
                </div>
                <div class="coin-price">S/ 15.90</div>
            </div>
            <div class="coin-item" style="border-color:var(--primary);">
                <div style="display:flex; gap:10px; align-items:center;">
                    <i class="fa-solid fa-crown" style="color:var(--primary);"></i>
                    <span style="color:var(--primary); font-weight:bold;">Pase Mensual (Todo incluido)</span>
                </div>
                <div class="coin-price" style="background:var(--primary); color:white;">S/ 29.90</div>
            </div>
        </div>
    </div>

    <nav class="bottom-nav">
        <div class="nav-item active" onclick="switchTab('home', this)">
            <i class="fa-solid fa-house"></i>Inicio
        </div>
        <div class="nav-item" onclick="switchTab('explore', this)">
            <i class="fa-solid fa-compass"></i>Explorar
        </div>
        <div class="nav-item" onclick="switchTab('mylist', this)">
            <i class="fa-solid fa-bookmark"></i>Mi Lista
        </div>
        <div class="nav-item" onclick="switchTab('premium', this)">
            <i class="fa-solid fa-crown"></i>Premium
        </div>
    </nav>

    <div id="searchModal" class="search-modal">
        <div style="display:flex; justify-content:space-between; margin-bottom:20px;">
            <h2>Buscar</h2>
            <i class="fa-solid fa-times" onclick="toggleSearch(false)" style="font-size:1.5rem;"></i>
        </div>
        <input type="text" class="search-bar" placeholder="Títulos, géneros..." onkeyup="handleSearch(this.value)">
        <div id="searchResults" style="margin-top:20px;"></div>
    </div>

    <div id="sheetOverlay" class="sheet-overlay" onclick="closeSheet()"></div>
    <div id="infoSheet" class="bottom-sheet">
        <div style="display:flex; gap:15px;">
            <img id="sheetImg" style="width:100px; height:150px; object-fit:cover; border-radius:8px;">
            <div>
                <h2 id="sheetTitle" style="margin-bottom:5px;">Título</h2>
                <p id="sheetMeta" style="color:#888; font-size:0.8rem;">2024 • Romance</p>
                <div style="margin-top:15px; display:flex; gap:10px;">
                    <button class="btn btn-white" id="btnPlay"><i class="fa-solid fa-play"></i> Ver</button>
                    <button class="btn btn-trans" id="btnAdd" onclick="toggleMyList()"><i class="fa-solid fa-plus"></i></button>
                </div>
            </div>
        </div>
        <p id="sheetDesc" style="color:#ccc; margin-top:20px; font-size:0.9rem; line-height:1.5;">Descripción...</p>
    </div>

    <script>
        // CONFIGURACIÓN DE TU API
        const API_URL = '/api/movies'; 
        
        let allData = [];
        let myFavorites = JSON.parse(localStorage.getItem('flechazo_favs')) || [];
        let currentItem = null;

        // --- MOCK DATA PARA DEMOSTRACIÓN (Eliminar al conectar API real) ---
        const mockData = [
            { id: 1, title: "La Venganza del CEO", img: "https://image.tmdb.org/t/p/w500/u3bZgnGQ9TWAZQv92dpa6lM9pUv.jpg", banner: "https://image.tmdb.org/t/p/original/t5zCBSB5xMDKkDqe91qahCOUYVV.jpg", tags: ["Venganza"], desc: "Regresa 5 años después para recuperar su imperio." },
            { id: 2, title: "Amor por Contrato", img: "https://image.tmdb.org/t/p/w500/1E5baAaEse26fej7uHcjOgEE2t2.jpg", banner: "https://image.tmdb.org/t/p/original/8rpDcsfLJypbO6vREc0547TJqqQ.jpg", tags: ["Romance"], desc: "Un matrimonio falso se convierte en real." },
            { id: 3, title: "Reina del Drama", img: "https://image.tmdb.org/t/p/w500/kdPMUMJzyYAc4roD52qavX0nLIC.jpg", banner: "https://image.tmdb.org/t/p/original/etj8E2o0Bud0HkONVQPjyCkIvpv.jpg", tags: ["Drama"], desc: "Traiciones en la alta sociedad." },
            { id: 4, title: "Mi Guardaespaldas", img: "https://image.tmdb.org/t/p/w500/ui4drTngfS1t1aBMOzT6lD6UItM.jpg", banner: "https://image.tmdb.org/t/p/original/9yBVqNruk6Ykrwc32qrK2TIE5xw.jpg", tags: ["Acción"], desc: "Él daría la vida por ella." },
            { id: 5, title: "Secretos", img: "https://image.tmdb.org/t/p/w500/lyP4Wzm381IXc60QxHe50wMPJSF.jpg", banner: "https://image.tmdb.org/t/p/original/4HodWWzbHsDwe09fK55Bq0Xf4tW.jpg", tags: ["Misterio"], desc: "Nada es lo que parece." },
            { id: 6, title: "Boda Sangrienta", img: "https://image.tmdb.org/t/p/w500/rktDFPbfHfUbArZ6OOOKsXcv0Bm.jpg", banner: "https://image.tmdb.org/t/p/original/fwZa8G8m40XzXjJ2Ld5aX5t5.jpg", tags: ["Thriller"], desc: "El día más feliz se vuelve una pesadilla." }
        ];

        window.onload = async () => {
            // Intenta cargar API, si falla usa MockData
            try {
                const res = await fetch(API_URL);
                if(res.ok) allData = await res.json();
                else allData = mockData;
            } catch { allData = mockData; }

            // Normalize
            allData = allData.map(d => ({
                id: d.id,
                title: d.title || d.nombre,
                img: d.img || (d.imagenes ? d.imagenes.poster : ""),
                banner: d.banner || (d.imagenes ? d.imagenes.banner : "") || d.img,
                desc: d.desc || "Sin descripción",
                tags: d.tags || ["Drama"]
            }));

            renderApp();
            renderMyList();
        };

        function renderApp() {
            if(!allData.length) return;

            // 1. HERO (Portada)
            const hero = allData[0];
            document.getElementById('heroContainer').innerHTML = `
                <img src="${hero.banner}" class="hero-img">
                <div class="hero-content">
                    <div class="hero-tags">
                        ${hero.tags.map(t => `<span>• ${t}</span>`).join('')}
                    </div>
                    <div class="hero-btns">
                        <button class="btn btn-white" onclick="location.href='player.html?id=${hero.id}'"><i class="fa-solid fa-play"></i> Reproducir</button>
                        <button class="btn btn-trans" onclick="openSheet('${hero.id}')"><i class="fa-solid fa-circle-info"></i> Info</button>
                    </div>
                </div>
            `;

            // 2. RANKING SLIDER (1, 2, 3...)
            // Usamos los primeros 5 elementos como Top
            const top5 = allData.slice(0, 6);
            document.getElementById('rankingSlider').innerHTML = top5.map((m, index) => `
                <div class="rank-card" onclick="openSheet('${m.id}')">
                    <div class="rank-number">${index + 1}</div>
                    <img src="${m.img}" class="rank-img">
                </div>
            `).join('');

            // 3. NUEVOS SLIDER (Estándar)
            document.getElementById('newSlider').innerHTML = allData.map(m => `
                <div class="poster-card" onclick="openSheet('${m.id}')">
                    <img src="${m.img}" class="poster-img">
                </div>
            `).join('');

            // 4. EXPLORE GRID
            document.getElementById('exploreGrid').innerHTML = allData.map(m => `
                <div onclick="openSheet('${m.id}')">
                    <img src="${m.img}" class="grid-img">
                </div>
            `).join('');
        }

        // --- SISTEMA DE PESTAÑAS ---
        function switchTab(tabId, btn) {
            document.querySelectorAll('.tab-content').forEach(e => e.classList.remove('active'));
            document.getElementById('tab-' + tabId).classList.add('active');
            
            document.querySelectorAll('.nav-item').forEach(e => e.classList.remove('active'));
            if(btn) btn.classList.add('active');
            else {
                // Si llamamos switchTab manualmente (desde header), buscamos el boton correspondiente
                const navBtn = [...document.querySelectorAll('.nav-item')].find(el => el.getAttribute('onclick').includes(tabId));
                if(navBtn) navBtn.classList.add('active');
            }
        }

        // --- BOTTOM SHEET INFO ---
        function openSheet(id) {
            const m = allData.find(x => String(x.id) === String(id));
            if(!m) return;
            currentItem = m;

            document.getElementById('sheetImg').src = m.img;
            document.getElementById('sheetTitle').innerText = m.title;
            document.getElementById('sheetMeta').innerText = "2024 • " + m.tags.join(', ');
            document.getElementById('sheetDesc').innerText = m.desc;
            document.getElementById('btnPlay').onclick = () => location.href = `player.html?id=${m.id}`;

            updateFavBtn();
            document.getElementById('sheetOverlay').classList.add('active');
            document.getElementById('infoSheet').classList.add('active');
        }

        function closeSheet() {
            document.getElementById('sheetOverlay').classList.remove('active');
            document.getElementById('infoSheet').classList.remove('active');
        }

        // --- FAVORITOS / LISTA ---
        function toggleMyList() {
            if(!currentItem) return;
            const id = String(currentItem.id);
            if(myFavorites.includes(id)) myFavorites = myFavorites.filter(x => x !== id);
            else myFavorites.push(id);
            
            localStorage.setItem('flechazo_favs', JSON.stringify(myFavorites));
            updateFavBtn();
            renderMyList();
        }

        function updateFavBtn() {
            const btn = document.getElementById('btnAdd');
            const id = String(currentItem.id);
            if(myFavorites.includes(id)) {
                btn.innerHTML = '<i class="fa-solid fa-check" style="color:var(--primary)"></i>';
            } else {
                btn.innerHTML = '<i class="fa-solid fa-plus"></i>';
            }
        }

        function renderMyList() {
            const favs = allData.filter(m => myFavorites.includes(String(m.id)));
            const container = document.getElementById('myListGrid');
            if(!favs.length) {
                container.innerHTML = '<p style="grid-column:1/-1; text-align:center; color:#555; margin-top:30px;">Tu lista está vacía.</p>';
            } else {
                container.innerHTML = favs.map(m => `
                    <div onclick="openSheet('${m.id}')">
                        <img src="${m.img}" class="grid-img">
                    </div>
                `).join('');
            }
        }

        // --- BUSQUEDA ---
        function toggleSearch(show) {
            const modal = document.getElementById('searchModal');
            modal.classList.toggle('active', show);
            if(show) modal.querySelector('input').focus();
        }

        function handleSearch(val) {
            const container = document.getElementById('searchResults');
            if(val.length < 2) { container.innerHTML = ""; return; }
            
            const results = allData.filter(m => m.title.toLowerCase().includes(val.toLowerCase()));
            container.innerHTML = results.map(m => `
                <div style="display:flex; gap:10px; margin-bottom:15px;" onclick="openSheet('${m.id}'); toggleSearch(false);">
                    <img src="${m.img}" style="width:50px; height:75px; object-fit:cover; border-radius:4px;">
                    <div>
                        <div style="font-weight:bold;">${m.title}</div>
                        <div style="font-size:0.8rem; color:#888;">${m.tags[0]}</div>
                    </div>
                </div>
            `).join('');
        }
    </script>
</body>
</html>
