<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#0f0f1a">
    <title>Flechazo TV</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        :root { --bg-dark: #1a1a2e; --primary: #ff4b4b; --gradient: linear-gradient(45deg, #ff4b4b, #a24bfa); --gold: #FFD700; --text: #fff; --card: #222230; }
        body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, Roboto, sans-serif; background: #0f0f1a; color: var(--text); padding-bottom: 90px; user-select: none; }
        
        /* UI Elements */
        .header { padding: 20px; display: flex; justify-content: space-between; align-items: center; background: rgba(15,15,26,0.9); position: sticky; top: 0; z-index: 50; }
        .poster-card { min-width: 120px; height: 180px; border-radius: 12px; overflow: hidden; background: #222; margin-right: 15px; position: relative; }
        .poster-card img { width: 100%; height: 100%; object-fit: cover; }
        .horizontal-scroll { display: flex; overflow-x: auto; padding: 0 20px; scrollbar-width: none; }
        .section-title { padding: 20px; font-weight: bold; font-size: 18px; }
        
        /* Profile & Premium */
        .profile-card { background: var(--card); margin: 20px; border-radius: 20px; padding: 25px; text-align: center; position: relative; overflow: hidden; }
        .avatar { width: 90px; height: 90px; border-radius: 50%; border: 3px solid var(--card); object-fit: cover; }
        .status-box { background: rgba(0,0,0,0.3); padding: 15px; margin-top: 20px; border-radius: 12px; display: flex; justify-content: space-between; align-items: center; }
        
        /* Modal */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 200; display: none; justify-content: center; align-items: center; }
        .modal-overlay.open { display: flex; }
        .modal-box { background: #151520; padding: 25px; border-radius: 20px; width: 85%; max-width: 400px; text-align: center; border: 1px solid #333; max-height: 90vh; overflow-y: auto; }
        
        /* QR Styles */
        .qr-tabs { display: flex; justify-content: center; gap: 10px; margin-bottom: 15px; }
        .qr-tab { padding: 8px 20px; background: #222; border-radius: 20px; font-size: 12px; color: #aaa; cursor: pointer; }
        .qr-tab.active { background: #8e2de2; color: white; }
        .qr-display { margin: 10px auto; width: 220px; height: 280px; background: white; padding: 5px; border-radius: 10px; display: none; }
        .qr-display.active { display: block; }
        .qr-display img { width: 100%; height: 100%; object-fit: contain; } /* Ajuste para que se vea todo el QR */
        
        /* Nav */
        .bottom-nav { position: fixed; bottom: 0; width: 100%; background: #151520; display: flex; justify-content: space-around; padding: 12px 0 25px 0; z-index: 100; border-top: 1px solid #333; }
        .nav-item { text-align: center; color: #666; font-size: 10px; }
        .nav-item.active { color: var(--primary); }
        .nav-item i { font-size: 20px; margin-bottom: 5px; display: block; }

        .hidden { display: none; }
    </style>
</head>
<body>

    <div id="tab-home" class="screen">
        <div class="header">
            <h2 style="margin:0; background:var(--gradient); -webkit-background-clip:text; -webkit-text-fill-color:transparent;">Flechazo TV</h2>
            <i class="fa-regular fa-bell"></i>
        </div>
        
        <div class="section-title">ðŸ”¥ Populares</div>
        <div class="horizontal-scroll" id="content-list">
            </div>
        <br><br>
    </div>

    <div id="tab-profile" class="screen hidden">
        <div class="profile-card">
            <img src="https://i.pinimg.com/736x/8b/16/7a/8b167af653c2399dd93b952a48740620.jpg" class="avatar">
            <h2 style="margin:10px 0;" id="user-email">Invitado</h2>
            
            <div class="status-box" id="sub-box">
                <div style="text-align:left;">
                    <div style="color:#aaa; font-size:10px;">ESTADO</div>
                    <div style="font-weight:bold;" id="status-text">Gratuito</div>
                </div>
                <button id="btn-upgrade" onclick="openModal('premium-modal')" style="background:var(--gold); border:none; padding:8px 15px; border-radius:20px; font-weight:bold; font-size:12px;">MEJORAR</button>
            </div>
            
            <div style="margin-top:20px; text-align:left;">
                <div style="padding:15px; border-bottom:1px solid #333;"><i class="fa-solid fa-download" style="margin-right:10px;"></i> Descargas</div>
                <div style="padding:15px; border-bottom:1px solid #333;" onclick="location.reload()"><i class="fa-solid fa-power-off" style="margin-right:10px; color:red;"></i> Salir</div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="premium-modal">
        <div class="modal-box">
            <i class="fa-solid fa-xmark" onclick="closeModal('premium-modal')" style="position:absolute; top:15px; right:15px; font-size:20px;"></i>
            <h2 style="color:var(--gold);">ðŸ’Ž Premium</h2>
            <p style="font-size:13px; color:#ccc;">Escanea y paga S/ 15.00</p>

            <div class="qr-tabs">
                <div class="qr-tab active" onclick="switchQR('yape', this)">YAPE</div>
                <div class="qr-tab" onclick="switchQR('plin', this)">OTROS</div>
            </div>

            <div id="qr-yape" class="qr-display active">
                <img src="https://i.ibb.co/PGZndj1h/IMG-0316.jpg" alt="Yape QR">
            </div>
            <div id="qr-plin" class="qr-display">
                <img src="https://i.ibb.co/k2wZZ7ZJ/IMG-0315.jpg" alt="Otro QR">
            </div>

            <div style="margin-top:15px; border-top:1px solid #333; padding-top:15px;">
                <p style="font-size:12px;">Sube tu comprobante:</p>
                <input type="file" id="proof-file" accept="image/*" style="font-size:12px; width:100%;">
                <button onclick="sendPayment()" id="btn-pay-send" style="width:100%; margin-top:10px; padding:12px; background:var(--gradient); border:none; border-radius:10px; color:white; font-weight:bold;">ENVIAR COMPROBANTE</button>
            </div>
        </div>
    </div>

    <nav class="bottom-nav">
        <div class="nav-item active" onclick="switchTab('home', this)"><i class="fa-solid fa-house"></i>Inicio</div>
        <div class="nav-item" onclick="switchTab('profile', this)"><i class="fa-solid fa-user"></i>Perfil</div>
    </nav>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, query, where, onSnapshot, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

        const firebaseConfig = { apiKey: "AIzaSyA29NMaEBVEApTr7qYbYmHuypZPMqA6jCQ", authDomain: "flechazo-tv.firebaseapp.com", projectId: "flechazo-tv", storageBucket: "flechazo-tv.firebasestorage.app", messagingSenderId: "382962164040", appId: "1:382962164040:web:6f24cad4108f824437137d" };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const storage = getStorage(app);
        let userUID = null; let userEmail = "";

        // AUTH
        onAuthStateChanged(auth, (user) => {
            if (user) {
                userUID = user.uid;
                userEmail = user.email;
                document.getElementById('user-email').innerText = user.email.split('@')[0];
                listenStatus();
            } else {
                // Modo demo si no hay login
                document.getElementById('user-email').innerText = "Invitado";
            }
        });

        // ENVIAR PAGO
        window.sendPayment = async () => {
            const file = document.getElementById('proof-file').files[0];
            const btn = document.getElementById('btn-pay-send');
            if(!file || !userUID) return alert("Sube una imagen o inicia sesiÃ³n.");
            
            btn.innerText = "Enviando..."; btn.disabled = true;
            try {
                const sRef = ref(storage, `pagos/${userUID}_${Date.now()}`);
                await uploadBytes(sRef, file);
                const url = await getDownloadURL(sRef);
                
                await addDoc(collection(db, "solicitudes_pago"), {
                    uid: userUID, email: userEmail, foto: url, fecha: new Date(), estado: "pendiente"
                });
                alert("Â¡Enviado! Espera nuestra confirmaciÃ³n.");
                closeModal('premium-modal');
            } catch(e) { alert("Error: " + e.message); }
            btn.innerText = "ENVIAR COMPROBANTE"; btn.disabled = false;
        }

        // ESCUCHAR ESTADO
        function listenStatus() {
            const q = query(collection(db, "solicitudes_pago"), where("uid", "==", userUID), orderBy("fecha", "desc"));
            onSnapshot(q, (snap) => {
                if(!snap.empty) {
                    const data = snap.docs[0].data();
                    const txt = document.getElementById('status-text');
                    const btn = document.getElementById('btn-upgrade');
                    const box = document.getElementById('sub-box');

                    if(data.estado === 'pendiente') {
                        txt.innerText = "Verificando..."; txt.style.color = "orange"; btn.style.display="none";
                    } else if(data.estado === 'aprobado') {
                        txt.innerText = "PREMIUM ACTIVO"; txt.style.color = "#FFD700"; btn.style.display="none";
                        box.style.border = "1px solid #FFD700";
                    } else {
                        txt.innerText = "Rechazado/Gratis"; txt.style.color = "white"; btn.style.display="block";
                    }
                }
            });
        }
    </script>

    <script>
        // UI SIMPLE
        const mockData = ["https://wallpapercave.com/wp/wp11899723.jpg", "https://wallpapercave.com/wp/wp8861445.jpg", "https://wallpapercave.com/wp/wp7642630.jpg"];
        mockData.forEach(src => document.getElementById('content-list').innerHTML += `<div class="poster-card"><img src="${src}"></div>`);

        window.switchTab = (id, el) => {
            document.querySelectorAll('.screen').forEach(s => s.classList.add('hidden'));
            document.getElementById('tab-'+id).classList.remove('hidden');
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
            el.classList.add('active');
        }
        window.switchQR = (t, el) => {
            document.querySelectorAll('.qr-tab').forEach(x => x.classList.remove('active')); el.classList.add('active');
            document.querySelectorAll('.qr-display').forEach(x => x.classList.remove('active'));
            document.getElementById('qr-'+t).classList.add('active');
        }
        window.openModal = (id) => document.getElementById(id).classList.add('open');
        window.closeModal = (id) => document.getElementById(id).classList.remove('open');
    </script>
</body>
</html>
