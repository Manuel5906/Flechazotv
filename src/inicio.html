<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flechazo TV</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #e50914; /* Rojo Netflix */
            --bg: #141414;
            --text: #ffffff;
            --glass: rgba(20, 20, 20, 0.85);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background-color: var(--bg); color: var(--text); padding-bottom: 70px; }

        /* --- SPLASH SCREEN --- */
        #splash {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: black; z-index: 9999; display: flex; justify-content: center; align-items: center;
            transition: opacity 0.5s ease;
        }
        .logo-anim { font-size: 2rem; color: var(--primary); font-weight: bold; animation: pulse 1.5s infinite; }

        /* --- UI PRINCIPAL --- */
        .navbar {
            position: fixed; top: 0; width: 100%; padding: 15px;
            background: linear-gradient(to bottom, rgba(0,0,0,0.7), transparent);
            z-index: 100; display: flex; justify-content: space-between; align-items: center;
        }
        .brand { color: var(--primary); font-weight: 900; font-size: 1.2rem; text-transform: uppercase; }

        /* HERO BANNER */
        #hero {
            height: 70vh; position: relative;
            background-size: cover; background-position: center;
            display: flex; flex-direction: column; justify-content: flex-end;
            padding: 20px;
        }
        #hero::after {
            content: ''; position: absolute; top:0; left:0; width:100%; height:100%;
            background: linear-gradient(to top, var(--bg), transparent);
        }
        .hero-content { position: relative; z-index: 2; margin-bottom: 20px; }
        .hero-title { font-size: 2.5rem; margin-bottom: 10px; text-shadow: 2px 2px 4px black; }
        .hero-desc { font-size: 0.9rem; color: #ddd; max-width: 80%; margin-bottom: 15px; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; }
        
        .btn-hero {
            padding: 10px 20px; border: none; border-radius: 4px; font-weight: bold; cursor: pointer; display: inline-flex; align-items: center; gap: 8px;
        }
        .btn-play { background: white; color: black; }
        .btn-list { background: rgba(109, 109, 110, 0.7); color: white; margin-left: 10px; }

        /* LISTAS HORIZONTALES */
        .category-row { margin: 20px 0; padding-left: 20px; }
        .cat-title { font-size: 1.1rem; font-weight: 600; margin-bottom: 10px; color: #e5e5e5; }
        
        .slider {
            display: flex; gap: 10px; overflow-x: auto; padding-bottom: 10px;
            scroll-behavior: smooth; scroll-snap-type: x mandatory;
        }
        .slider::-webkit-scrollbar { display: none; } /* Ocultar barra scroll */
        
        .card {
            min-width: 120px; height: 180px; border-radius: 6px;
            background-color: #333; overflow: hidden; position: relative;
            cursor: pointer; scroll-snap-align: start; transition: transform 0.2s;
        }
        .card img { width: 100%; height: 100%; object-fit: cover; }
        .card:hover { transform: scale(1.05); z-index: 10; border: 2px solid white; }

        /* BOTTOM NAVIGATION */
        .bottom-nav {
            position: fixed; bottom: 0; width: 100%; height: 60px;
            background: #121212; border-top: 1px solid #333;
            display: flex; justify-content: space-around; align-items: center; z-index: 100;
        }
        .nav-item { color: #888; font-size: 0.8rem; text-align: center; text-decoration: none; }
        .nav-item i { display: block; font-size: 1.2rem; margin-bottom: 4px; }
        .nav-item.active { color: white; }

        /* MODAL REPRODUCTOR */
        #playerModal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: black; z-index: 2000; display: none; flex-direction: column;
        }
        .player-header { padding: 15px; display: flex; justify-content: space-between; align-items: center; }
        .close-btn { color: white; font-size: 1.5rem; cursor: pointer; background: none; border: none; }
        
        video { width: 100%; max-height: 40vh; background: black; }
        
        .player-info { padding: 20px; flex: 1; overflow-y: auto; }
        .ep-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(60px, 1fr)); gap: 10px; margin-top: 15px; }
        .ep-btn {
            background: #333; color: white; border: none; padding: 10px; border-radius: 4px; cursor: pointer;
        }
        .ep-btn.active { background: var(--primary); }

        @keyframes pulse { 0% { opacity: 0.6; } 50% { opacity: 1; } 100% { opacity: 0.6; } }
    </style>
</head>
<body>

    <div id="splash">
        <div class="logo-anim">FLECHAZO TV</div>
    </div>

    <div class="navbar">
        <div class="brand">F</div>
        <div class="user-icon"><i class="fa-solid fa-user"></i></div>
    </div>

    <div id="app">
        <header id="hero"></header>

        <div id="categories"></div>
    </div>

    <nav class="bottom-nav">
        <a href="#" class="nav-item active"><i class="fa-solid fa-house"></i>Inicio</a>
        <a href="#" class="nav-item"><i class="fa-solid fa-clapperboard"></i>Shorts</a>
        <a href="#" class="nav-item"><i class="fa-solid fa-magnifying-glass"></i>Explorar</a>
        <a href="#" class="nav-item"><i class="fa-solid fa-user"></i>Perfil</a>
    </nav>

    <div id="playerModal">
        <div class="player-header">
            <span id="playerTitle">Título</span>
            <button class="close-btn" onclick="cerrarPlayer()"><i class="fa-solid fa-xmark"></i></button>
        </div>
        <video id="videoScreen" controls playsinline></video>
        <div class="player-info">
            <h2 id="infoTitle" style="margin-bottom: 10px;"></h2>
            <p id="infoDesc" style="color: #aaa; font-size: 0.9rem;"></p>
            
            <div id="seriesZone" style="display:none; margin-top: 20px;">
                <h4 style="color: #ddd;">Episodios</h4>
                <div id="episodesList" class="ep-grid"></div>
            </div>
        </div>
    </div>

    <script>
        // API URL (Ajusta si usas otra ruta)
        const API_URL = '/api/movies';

        // Variables Globales
        let contenido = [];
        const splash = document.getElementById('splash');
        const hero = document.getElementById('hero');
        const categoriesContainer = document.getElementById('categories');
        
        // Elementos del Reproductor
        const playerModal = document.getElementById('playerModal');
        const videoScreen = document.getElementById('videoScreen');
        const playerTitle = document.getElementById('playerTitle');
        const infoTitle = document.getElementById('infoTitle');
        const infoDesc = document.getElementById('infoDesc');
        const seriesZone = document.getElementById('seriesZone');
        const episodesList = document.getElementById('episodesList');

        // INICIAR APP
        window.addEventListener('load', async () => {
            // Simular carga y quitar Splash
            setTimeout(() => {
                splash.style.opacity = '0';
                setTimeout(() => splash.style.display = 'none', 500);
            }, 1500);

            await cargarDatos();
        });

        async function cargarDatos() {
            try {
                const res = await fetch(API_URL);
                contenido = await res.json();
                
                if (contenido.length > 0) {
                    construirHero(contenido);
                    construirCategorias(contenido);
                }
            } catch (error) {
                console.error("Error conectando API:", error);
                hero.innerHTML = "<h1>Error de conexión con el Servidor</h1>";
            }
        }

        // --- CONSTRUCTOR DEL HERO (Portada Grande) ---
        function construirHero(datos) {
            // Elegir uno al azar para la portada
            const randomItem = datos[Math.floor(Math.random() * datos.length)];
            
            hero.style.backgroundImage = `url('${randomItem.img}')`;
            hero.innerHTML = `
                <div class="hero-content">
                    <h1 class="hero-title">${randomItem.title}</h1>
                    <p class="hero-desc">${randomItem.desc}</p>
                    <div class="hero-buttons">
                        <button class="btn-hero btn-play" onclick="abrirPlayer(${randomItem.id})">
                            <i class="fa-solid fa-play"></i> Reproducir
                        </button>
                        <button class="btn-hero btn-list">
                            <i class="fa-solid fa-plus"></i> Mi Lista
                        </button>
                    </div>
                </div>
            `;
        }

        // --- CONSTRUCTOR DE FILAS ---
        function construirCategorias(datos) {
            // Agrupamos por categoría (Romance, Acción, etc.)
            const categorias = {};
            datos.forEach(item => {
                if (!categorias[item.cat]) categorias[item.cat] = [];
                categorias[item.cat].push(item);
            });

            // Crear HTML por cada categoría
            for (const [catNombre, items] of Object.entries(categorias)) {
                const fila = document.createElement('div');
                fila.className = 'category-row';
                
                let cartasHTML = items.map(item => `
                    <div class="card" onclick="abrirPlayer(${item.id})">
                        <img src="${item.img}" alt="${item.title}" loading="lazy">
                    </div>
                `).join('');

                fila.innerHTML = `
                    <h3 class="cat-title">${catNombre}</h3>
                    <div class="slider">
                        ${cartasHTML}
                    </div>
                `;
                categoriesContainer.appendChild(fila);
            }
        }

        // --- LÓGICA DEL REPRODUCTOR (MÁGICA) ---
        function abrirPlayer(id) {
            const item = contenido.find(c => c.id === id);
            if (!item) return;

            // Llenar datos visuales
            playerTitle.innerText = item.title;
            infoTitle.innerText = item.title;
            infoDesc.innerText = item.desc;
            
            // Limpiar zona de episodios
            episodesList.innerHTML = '';
            
            // Lógica SERIE vs PELÍCULA
            if (item.tipo === 'pelicula') {
                seriesZone.style.display = 'none';
                videoScreen.src = item.url || ''; 
                videoScreen.play();
            } else {
                // Es SERIE
                seriesZone.style.display = 'block';
                
                // Crear botones para cada episodio
                if (item.episodios && item.episodios.length > 0) {
                    item.episodios.forEach((ep, index) => {
                        const btn = document.createElement('button');
                        btn.className = 'ep-btn';
                        btn.innerText = ep.numero;
                        
                        if (index === 0) btn.classList.add('active'); // Marcar el 1ro

                        btn.onclick = () => {
                            // Quitar active a todos
                            document.querySelectorAll('.ep-btn').forEach(b => b.classList.remove('active'));
                            btn.classList.add('active');
                            // Cambiar video
                            videoScreen.src = ep.url;
                            videoScreen.play();
                        };
                        episodesList.appendChild(btn);
                    });
                    
                    // Cargar el episodio 1 automáticamente
                    videoScreen.src = item.episodios[0].url;
                    videoScreen.play();
                }
            }

            // Mostrar el modal
            playerModal.style.display = 'flex';
        }

        function cerrarPlayer() {
            videoScreen.pause();
            videoScreen.src = ""; // Detener carga de datos
            playerModal.style.display = 'none';
        }
    </script>
</body>
</html>
