<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#0f0f1a">
    <title>Flechazo TV - V5 ULTRA</title>
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet">
    
    <style>
        /* --- 1. CORE CSS --- */
        :root { 
            --bg: #0f0f1a; --card: #1e1e2d; --primary: #E50914; --text: #fff;
            --safe-top: env(safe-area-inset-top); --safe-bottom: env(safe-area-inset-bottom);
        }
        
        /* Temas */
        body.theme-blue { --bg: #0a101a; --card: #15202b; --primary: #0088cc; }
        body.theme-green { --bg: #0a1a10; --card: #152b1d; --primary: #00cc66; }
        body.theme-purple { --bg: #150a1a; --card: #25152b; --primary: #aa00cc; }
        body.theme-gold { --bg: #1a150a; --card: #2b2515; --primary: #cca300; }

        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); padding-bottom: calc(90px + var(--safe-bottom)); overflow-x: hidden; user-select: none; -webkit-font-smoothing: antialiased; }

        /* --- 2. MULTI-PERFIL --- */
        #profile-gate { position: fixed; inset: 0; background: var(--bg); z-index: 8000; display: flex; flex-direction: column; align-items: center; justify-content: center; animation: fadeIn 0.5s; }
        .gate-title { font-size: 24px; font-weight: 600; margin-bottom: 40px; }
        .gate-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; }
        .gate-item { display: flex; flex-direction: column; align-items: center; gap: 10px; cursor: pointer; transition: transform 0.2s; }
        .gate-item:active { transform: scale(0.95); }
        .gate-img { width: 100px; height: 100px; border-radius: 8px; border: 2px solid transparent; object-fit: cover; }
        .gate-item.active .gate-img { border-color: var(--text); }
        .gate-name { font-size: 14px; color: #ccc; }
        
        /* --- 3. UI GENERAL --- */
        .screen { display: none; animation: fadeEffect 0.3s; padding-bottom: 20px; }
        .screen.active { display: block; }
        
        .header { position: sticky; top: 0; padding: calc(10px + var(--safe-top)) 20px 10px; background: rgba(15,15,26,0.95); backdrop-filter: blur(10px); z-index: 100; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .logo { color: var(--primary); font-weight: 900; font-size: 22px; text-transform: uppercase; letter-spacing: -1px; }

        /* HERO */
        .hero-wrap { height: 65vh; position: relative; display: flex; align-items: flex-end; margin-top: -60px; }
        .hero-bg { position: absolute; inset: 0; width: 100%; height: 100%; object-fit: cover; z-index: -1; mask-image: linear-gradient(to bottom, black 70%, transparent 100%); -webkit-mask-image: linear-gradient(to bottom, black 70%, transparent 100%); }
        .hero-gradient { position: absolute; inset: 0; background: linear-gradient(to top, var(--bg) 0%, rgba(15,15,26,0.1) 50%, rgba(15,15,26,0.8) 100%); }
        .hero-content { padding: 20px; z-index: 2; width: 100%; }
        .hero-tags { display: flex; gap: 8px; margin-bottom: 8px; }
        .tag { background: rgba(255,255,255,0.2); backdrop-filter: blur(5px); padding: 4px 8px; border-radius: 4px; font-size: 10px; font-weight: 700; text-transform: uppercase; border: 1px solid rgba(255,255,255,0.1); }
        .hero-title { font-size: 42px; font-weight: 900; line-height: 0.9; margin-bottom: 10px; text-shadow: 0 4px 20px #000; }
        
        .btn-group { display: flex; gap: 10px; margin-top: 15px; }
        .btn { flex: 1; height: 42px; border-radius: 8px; border: none; font-weight: 700; font-size: 14px; display: flex; align-items: center; justify-content: center; gap: 8px; cursor: pointer; transition: 0.2s; }
        .btn:active { transform: scale(0.96); }
        .btn-play { background: #fff; color: #000; }
        .btn-info { background: rgba(255,255,255,0.25); color: #fff; backdrop-filter: blur(10px); }

        /* LISTAS & CARDS */
        .section { margin-top: 35px; }
        .sec-head { padding: 0 20px 10px; display: flex; justify-content: space-between; align-items: flex-end; }
        .sec-title { font-size: 17px; font-weight: 700; display: flex; align-items: center; gap: 8px; }
        .h-list { display: flex; overflow-x: auto; gap: 12px; padding: 0 20px; scrollbar-width: none; }
        
        .card { width: 115px; flex-shrink: 0; position: relative; cursor: pointer; transition: transform 0.2s; }
        .card:active { transform: scale(0.95); }
        .card-img { width: 100%; height: 165px; border-radius: 8px; object-fit: cover; background: #222; }

        /* DETAILS SHEET */
        #details-sheet { position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 6000; display: none; align-items: flex-end; backdrop-filter: blur(5px); opacity: 0; transition: opacity 0.3s; }
        #details-sheet.open { opacity: 1; }
        .sheet-content { background: #181820; width: 100%; max-height: 85vh; border-radius: 20px 20px 0 0; overflow-y: auto; position: relative; transform: translateY(100%); transition: transform 0.3s cubic-bezier(0.1, 0.7, 0.1, 1); box-shadow: 0 -10px 40px rgba(0,0,0,0.5); }
        #details-sheet.open .sheet-content { transform: translateY(0); }
        
        .sheet-hero { position: relative; height: 250px; }
        .sheet-img { width: 100%; height: 100%; object-fit: cover; mask-image: linear-gradient(to bottom, black 80%, transparent 100%); -webkit-mask-image: linear-gradient(to bottom, black 80%, transparent 100%); }
        .sheet-close { position: absolute; top: 15px; right: 15px; width: 30px; height: 30px; background: rgba(0,0,0,0.5); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #fff; cursor: pointer; z-index: 10; }
        .sheet-body { padding: 20px; margin-top: -40px; position: relative; z-index: 2; }
        
        /* --- 4. PERFIL AVANZADO (NUEVO) --- */
        .profile-head { text-align: center; padding: 20px 20px 0; }
        .avatar-container { position: relative; width: 90px; height: 90px; margin: 0 auto; }
        .avatar { width: 100%; height: 100%; border-radius: 50%; border: 3px solid var(--primary); object-fit: cover; }
        .edit-badge { position: absolute; bottom: 0; right: 0; background: var(--card); padding: 5px; border-radius: 50%; border: 1px solid #333; cursor: pointer; }
        
        .stats { display: flex; justify-content: center; gap: 15px; margin: 20px 0; }
        .stat-card { background: var(--card); padding: 12px; border-radius: 8px; width: 100px; text-align: center; }
        .stat-num { font-size: 18px; font-weight: 800; color: #fff; }
        .stat-label { font-size: 11px; color: #aaa; }

        /* Membresía Card */
        .premium-card { background: linear-gradient(135deg, #1c1c2a, #3a3a4d); padding: 20px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.1); margin: 20px 20px; position: relative; overflow: hidden; }
        .premium-card::before { content: ''; position: absolute; top: -50px; right: -50px; width: 100px; height: 100px; background: rgba(255,215,0,0.1); border-radius: 50%; filter: blur(20px); }
        .gold-txt { color: #FFD700; font-weight: 800; text-transform: uppercase; font-size: 12px; letter-spacing: 1px; }

        /* Ajustes y Toggles */
        .settings-list { padding: 0 20px; margin-bottom: 20px; }
        .setting-item { display: flex; justify-content: space-between; align-items: center; padding: 16px 0; border-bottom: 1px solid rgba(255,255,255,0.05); cursor: pointer; }
        .setting-left { display: flex; align-items: center; gap: 12px; font-size: 14px; color: #eee; }
        .setting-icon { width: 30px; display: flex; justify-content: center; color: #888; }
        
        /* Switch CSS */
        .switch { position: relative; display: inline-block; width: 36px; height: 20px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #333; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 14px; width: 14px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--primary); }
        input:checked + .slider:before { transform: translateX(16px); }

        /* --- 5. TOAST & MODALS --- */
        #toast-container { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 9000; width: 90%; max-width: 350px; }
        .toast { background: rgba(30,30,40,0.95); backdrop-filter: blur(10px); border-radius: 12px; padding: 15px; margin-bottom: 10px; display: flex; align-items: center; gap: 12px; animation: slideDown 0.3s; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 5px 20px rgba(0,0,0,0.5); }
        
        /* --- 6. PLAYER & NAV --- */
        .player-fs { position: fixed; inset: 0; background: #000; z-index: 7000; display: none; align-items: center; justify-content: center; }
        .close-player { position: absolute; top: 30px; left: 20px; font-size: 24px; color: #fff; z-index: 7001; cursor: pointer; filter: drop-shadow(0 0 5px #000); }
        #video-container { width: 100%; height: 100%; }
        iframe, video { width: 100%; height: 100%; border: none; }

        .nav { position: fixed; bottom: 0; width: 100%; background: rgba(15,15,26,0.98); border-top: 1px solid #333; display: flex; justify-content: space-around; padding: 12px 0 calc(12px + var(--safe-bottom)); z-index: 2000; backdrop-filter: blur(10px); }
        .nav-item { color: #666; font-size: 10px; display: flex; flex-direction: column; align-items: center; gap: 4px; cursor: pointer; transition: 0.2s; }
        .nav-item.active { color: var(--primary); transform: translateY(-2px); }
        .nav-item i { font-size: 20px; }
        
        /* Utils */
        .hidden { display: none !important; }
        @keyframes slideDown { from { transform: translateY(-20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes fadeEffect { from { opacity: 0; } to { opacity: 1; } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

    <div id="splash" style="position:fixed; inset:0; background:var(--bg); z-index:9999; display:flex; align-items:center; justify-content:center; flex-direction:column; transition:0.5s;">
        <div style="font-size:30px; font-weight:900; color:var(--primary); letter-spacing:-1px;">FLECHAZO TV</div>
        <div style="margin-top:20px; color:#666; font-size:12px;">Cargando experiencia V5...</div>
    </div>

    <div id="toast-container"></div>

    <div id="player-fs" class="player-fs">
        <i class="fa-solid fa-chevron-left close-player" onclick="closePlayer()"></i>
        <div id="video-container"></div>
    </div>

    <div id="details-sheet" onclick="if(event.target === this) closeSheet()">
        <div class="sheet-content" id="sheet-content"></div>
    </div>

    <div id="profile-gate">
        <div class="gate-title">¿Quién está viendo?</div>
        <div class="gate-grid" id="profile-grid">
            </div>
    </div>

    <div id="edit-modal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.8); z-index:8500; align-items:center; justify-content:center;">
        <div style="background:var(--card); padding:20px; border-radius:12px; width:80%; max-width:300px;">
            <h3>Editar Perfil</h3>
            <input type="text" id="edit-name" placeholder="Nombre" style="width:100%; padding:10px; margin:10px 0; background:#333; border:none; color:#fff; border-radius:6px;">
            <div style="display:flex; gap:10px;">
                <button onclick="document.getElementById('edit-modal').style.display='none'" style="flex:1; padding:10px; border-radius:6px; background:#444; color:#fff; border:none;">Cancelar</button>
                <button onclick="saveProfileChanges()" style="flex:1; padding:10px; border-radius:6px; background:var(--primary); color:#fff; border:none;">Guardar</button>
            </div>
        </div>
    </div>

    <div id="app" class="hidden">
        
        <div id="tab-home" class="screen active">
            <header class="header">
                <div class="logo">Flechazo TV</div>
                <div onclick="showToast('Sin novedades', 'bell')" style="width:35px; height:35px; background:rgba(255,255,255,0.1); border-radius:50%; display:flex; align-items:center; justify-content:center;">
                    <i class="fa-solid fa-bell"></i>
                </div>
            </header>
            <div id="hero-container"></div>
            <div class="section">
                <div class="sec-head"><span class="sec-title">Tendencias</span></div>
                <div class="h-list" id="list-trends"></div>
            </div>
            <div class="section">
                <div class="sec-head"><span class="sec-title">Top 10 en Perú</span></div>
                <div class="h-list" id="list-top10"></div>
            </div>
        </div>

        <div id="tab-explore" class="screen">
            <div style="padding:15px 20px; position:sticky; top:0; z-index:90; background:var(--bg);">
                <div style="background:rgba(255,255,255,0.1); border-radius:10px; padding:12px; display:flex; gap:10px;">
                    <i class="fa-solid fa-magnifying-glass" style="color:#888;"></i>
                    <input type="text" placeholder="Películas, series, géneros..." style="background:none; border:none; color:#fff; width:100%; font-size:16px;" onkeyup="runSearch(this.value)">
                </div>
            </div>
            <div id="search-results" style="padding:0 20px; display:grid; grid-template-columns:repeat(3, 1fr); gap:10px;"></div>
        </div>

        <div id="tab-profile" class="screen">
            <div class="profile-head">
                <div class="avatar-container" onclick="openEditProfile()">
                    <img src="" id="profile-pic-settings" class="avatar">
                    <div class="edit-badge"><i class="fa-solid fa-pencil" style="font-size:12px;"></i></div>
                </div>
                <h2 id="profile-name-settings" style="margin:10px 0 5px;">Usuario</h2>
                <div style="font-size:12px; color:#aaa;">Miembro desde 2025</div>
                
                <div class="stats">
                    <div class="stat-card"><div class="stat-num" id="st-watched">0</div><div class="stat-label">Vistos</div></div>
                    <div class="stat-card"><div class="stat-num" id="st-list">0</div><div class="stat-label">Lista</div></div>
                    <div class="stat-card"><div class="stat-num" id="st-likes">0</div><div class="stat-label">Likes</div></div>
                </div>
            </div>

            <div class="premium-card">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <div>
                        <div class="gold-txt">PLAN ACTUAL</div>
                        <div style="font-size:20px; font-weight:900;">VIP 4K UHD</div>
                    </div>
                    <i class="fa-solid fa-crown" style="font-size:30px; color:#FFD700;"></i>
                </div>
                <div style="margin-top:10px; font-size:12px; color:#ccc;">Próxima facturación: 25 Ene 2026</div>
            </div>

            <h4 style="padding:0 20px; color:#888; margin-bottom:10px;">CONFIGURACIÓN</h4>
            <div class="settings-list">
                <div class="setting-item">
                    <div class="setting-left">
                        <div class="setting-icon"><i class="fa-solid fa-wifi"></i></div>
                        Descargar solo con Wi-Fi
                    </div>
                    <label class="switch"><input type="checkbox" checked onchange="saveSetting('wifi', this.checked)"><span class="slider round"></span></label>
                </div>
                <div class="setting-item">
                    <div class="setting-left">
                        <div class="setting-icon"><i class="fa-solid fa-circle-play"></i></div>
                        Autoplay siguiente episodio
                    </div>
                    <label class="switch"><input type="checkbox" onchange="saveSetting('autoplay', this.checked)"><span class="slider round"></span></label>
                </div>
                <div class="setting-item" onclick="showToast('Simulación: Calidad guardada', 'video')">
                    <div class="setting-left">
                        <div class="setting-icon"><i class="fa-solid fa-sliders"></i></div>
                        Calidad de Video
                    </div>
                    <div style="font-size:12px; color:#666;">Automática ></div>
                </div>
            </div>

            <h4 style="padding:0 20px; color:#888; margin-bottom:10px;">CUENTA</h4>
            <div class="settings-list">
                <div class="setting-item" onclick="showToast('0 descargas activas', 'download')">
                    <div class="setting-left">
                        <div class="setting-icon"><i class="fa-solid fa-download"></i></div>
                        Mis Descargas
                    </div>
                </div>
                <div class="setting-item" onclick="changeProfile()">
                    <div class="setting-left">
                        <div class="setting-icon"><i class="fa-solid fa-users"></i></div>
                        Cambiar de Perfil
                    </div>
                </div>
                <div class="setting-item" onclick="resetApp()" style="border-bottom:none;">
                    <div class="setting-left" style="color:#ff4b4b;">
                        <div class="setting-icon" style="color:#ff4b4b;"><i class="fa-solid fa-trash"></i></div>
                        Borrar Datos / Cerrar Sesión
                    </div>
                </div>
            </div>
            
            <div style="text-align:center; padding:20px; color:#444; font-size:11px;">
                Versión 5.0.1 MAX - Build 2025
            </div>
        </div>

    </div>

    <div id="navbar" class="nav hidden">
        <div class="nav-item active" onclick="goTab('home', this)"><i class="fa-solid fa-house"></i>Inicio</div>
        <div class="nav-item" onclick="goTab('explore', this)"><i class="fa-solid fa-compass"></i>Explorar</div>
        <div class="nav-item" onclick="goTab('profile', this)"><i class="fa-solid fa-user"></i>Perfil</div>
    </div>

    <script>
        const API_URL = 'https://flechazotv.vercel.app/api/movies';
        let moviesDB = [];
        let currentProfile = null;
        const defaultProfiles = [
            { id: 1, name: 'Gamer Pro', img: 'https://i.pinimg.com/736x/8b/16/7a/8b167af653c2399dd93b952a48740620.jpg' },
            { id: 2, name: 'Familia', img: 'https://i.pinimg.com/564x/4d/9d/3e/4d9d3e8e1784534a621796d1955746f1.jpg' }
        ];

        // --- 1. INICIO ---
        window.onload = async () => {
            try {
                const res = await fetch(API_URL);
                moviesDB = await res.json();
            } catch(e) { console.log('Offline'); }
            
            setTimeout(() => {
                document.getElementById('splash').style.opacity = '0';
                setTimeout(() => document.getElementById('splash').style.display='none', 500);
                renderGate();
            }, 1500);
        };

        // --- 2. PERFILES ---
        function renderGate() {
            const grid = document.getElementById('profile-grid');
            grid.innerHTML = defaultProfiles.map(p => `
                <div class="gate-item" onclick="selectProfile(${p.id})">
                    <img src="${p.img}" class="gate-img">
                    <span class="gate-name">${p.name}</span>
                </div>
            `).join('');
        }
        function selectProfile(id) {
            currentProfile = defaultProfiles.find(p => p.id === id);
            document.getElementById('profile-gate').style.display = 'none';
            document.getElementById('app').classList.remove('hidden');
            document.getElementById('navbar').classList.remove('hidden');
            loadProfileUI();
            if(moviesDB.length) initContent();
        }
        function changeProfile() {
            document.getElementById('profile-gate').style.display = 'flex';
            document.getElementById('app').classList.add('hidden');
            document.getElementById('navbar').classList.add('hidden');
        }

        // --- 3. CONTENIDO ---
        function initContent() {
            renderHero(moviesDB[0]);
            renderList('list-trends', moviesDB);
            renderTop10(moviesDB);
            renderSearch(moviesDB);
        }

        function renderHero(m) {
            document.getElementById('hero-container').innerHTML = `
                <div class="hero-wrap">
                    <img src="${m.img}" class="hero-bg">
                    <div class="hero-gradient"></div>
                    <div class="hero-content">
                        <div class="hero-tags"><span class="tag">Nº 1</span><span class="tag">4K HDR</span></div>
                        <h1 class="hero-title">${m.title}</h1>
                        <div class="btn-group">
                            <button class="btn btn-play" onclick="playVideo('${m.videoUrl}')"><i class="fa-solid fa-play"></i> Ver</button>
                            <button class="btn btn-info" onclick="openSheet(${m.id})"><i class="fa-solid fa-info-circle"></i> Info</button>
                        </div>
                    </div>
                </div>`;
        }

        function renderList(id, list) {
            document.getElementById(id).innerHTML = list.map(m => `
                <div class="card" onclick="openSheet(${m.id})"><img src="${m.img}" class="card-img" loading="lazy"></div>
            `).join('');
        }

        function renderTop10(list) {
            document.getElementById('list-top10').innerHTML = list.slice(0, 5).map((m,i) => `
                <div class="rank-card" onclick="openSheet(${m.id})">
                    <span class="rank-num">${i+1}</span>
                    <img src="${m.img}" class="rank-img">
                </div>`).join('');
        }

        // --- 4. DETAILS SHEET ---
        function openSheet(id) {
            const m = moviesDB.find(x => x.id === id);
            const sheet = document.getElementById('details-sheet');
            const content = document.getElementById('sheet-content');
            
            content.innerHTML = `
                <div class="sheet-hero">
                    <img src="${m.img}" class="sheet-img">
                    <div class="sheet-close" onclick="closeSheet()"><i class="fa-solid fa-xmark"></i></div>
                </div>
                <div class="sheet-body">
                    <h2 class="sheet-title">${m.title}</h2>
                    <div class="sheet-meta">
                        <span style="color:#46d369;font-weight:900">99% Match</span>
                        <span>2025</span>
                        <span class="meta-tag">4K</span>
                        <span class="meta-tag">ATMOS</span>
                    </div>
                    <p class="sheet-desc">${m.desc}</p>
                    <div class="sheet-actions">
                        <button class="s-btn s-btn-play" onclick="playVideo('${m.videoUrl}');closeSheet()"><i class="fa-solid fa-play"></i> Reproducir</button>
                        <button class="s-btn s-btn-dl" onclick="showToast('Descargando...', 'download')"><i class="fa-solid fa-download"></i> Descargar</button>
                    </div>
                </div>`;
            sheet.style.display = 'flex';
            setTimeout(() => sheet.classList.add('open'), 10);
        }
        function closeSheet() {
            const sheet = document.getElementById('details-sheet');
            sheet.classList.remove('open');
            setTimeout(() => sheet.style.display='none', 300);
        }

        // --- 5. PERFIL & AJUSTES ---
        function loadProfileUI() {
            document.getElementById('profile-pic-settings').src = currentProfile.img;
            document.getElementById('profile-name-settings').innerText = currentProfile.name;
            updateStats();
        }
        function updateStats() {
            const hist = JSON.parse(localStorage.getItem('f_hist')) || {};
            const list = JSON.parse(localStorage.getItem('f_list')) || [];
            document.getElementById('st-watched').innerText = Object.keys(hist).length;
            document.getElementById('st-list').innerText = list.length;
        }
        function saveSetting(key, val) {
            localStorage.setItem('set_'+key, val);
            showToast(val ? 'Activado' : 'Desactivado', 'check');
        }
        function openEditProfile() { document.getElementById('edit-modal').style.display='flex'; }
        function saveProfileChanges() {
            const name = document.getElementById('edit-name').value;
            if(name) {
                currentProfile.name = name;
                loadProfileUI();
                document.getElementById('edit-modal').style.display='none';
            }
        }
        function resetApp() { if(confirm("¿Borrar todo?")) { localStorage.clear(); location.reload(); } }

        // --- 6. PLAYER & UTILS ---
        function playVideo(url) {
            const player = document.getElementById('player-fs');
            const con = document.getElementById('video-container');
            let src = url;
            if(url.includes('youtu')) {
                const vid = url.includes('v=') ? url.split('v=')[1] : url.split('/').pop();
                src = `https://www.youtube.com/embed/${vid}?autoplay=1&rel=0`;
                con.innerHTML = `<iframe src="${src}" allowfullscreen></iframe>`;
            } else {
                con.innerHTML = `<video src="${url}" controls autoplay playsinline></video>`;
            }
            player.style.display = 'flex';
        }
        function closePlayer() {
            document.getElementById('video-container').innerHTML = '';
            document.getElementById('player-fs').style.display = 'none';
        }
        function runSearch(v) {
            const res = document.getElementById('search-results');
            const list = v ? moviesDB.filter(m => m.title.toLowerCase().includes(v.toLowerCase())) : moviesDB;
            res.innerHTML = list.map(m => `<div onclick="openSheet(${m.id})"><img src="${m.img}" style="width:100%;height:150px;object-fit:cover;border-radius:6px;background:#222"></div>`).join('');
        }
        function renderSearch(l) { runSearch(''); }
        function goTab(t, el) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('tab-'+t).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
            el.classList.add('active');
        }
        function showToast(m, i) {
            const t = document.createElement('div'); t.className = 'toast';
            t.innerHTML = `<i class="fa-solid fa-${i}"></i> ${m}`;
            document.getElementById('toast-container').appendChild(t);
            setTimeout(() => t.remove(), 3000);
        }
    </script>
</body>
</html>
