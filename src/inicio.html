<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#0f0f1a">
    <title>Flechazo TV</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        /* --- ESTILOS BASE --- */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        :root { --bg: #0f0f1a; --card: #1e1e2d; --primary: #ff4b4b; --text: #fff; }
        body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: var(--bg); color: var(--text); padding-bottom: 80px; user-select: none; }
        .hidden { display: none !important; }

        /* --- UI COMPONENTS --- */
        .poster-card { min-width: 110px; width: 110px; height: 160px; border-radius: 8px; overflow: hidden; background: #222; margin-right: 10px; position: relative; }
        .poster-card img { width: 100%; height: 100%; object-fit: cover; }
        .horizontal-scroll { display: flex; overflow-x: auto; padding: 0 20px 20px; scrollbar-width: none; }
        .section-title { padding: 20px 20px 10px; font-weight: 700; font-size: 17px; }
        .header { padding: 15px 20px; background: rgba(15,15,26,0.95); position: sticky; top: 0; z-index: 50; display: flex; justify-content: space-between; align-items: center; backdrop-filter: blur(10px); }
        .logo { font-size: 22px; font-weight: 800; background: linear-gradient(45deg, #ff4b4b, #a24bfa); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin: 0; }

        /* --- MODAL DETALLE (ARREGLADO Y BONITO) --- */
        .modal-overlay { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.85); z-index: 500; display: none; 
            justify-content: center; align-items: flex-end; backdrop-filter: blur(8px);
        }
        .modal-overlay.open { display: flex; animation: fadeIn 0.3s; }
        .modal-sheet { 
            background: #15151e; width: 100%; max-width: 500px; 
            border-radius: 25px 25px 0 0; padding: 0; /* Padding 0 para que la imagen toque bordes */
            max-height: 90vh; overflow-y: auto; 
            animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1); 
            box-shadow: 0 -10px 40px rgba(0,0,0,0.5);
            position: relative;
        }

        /* Estilo Hero del Modal */
        .detail-hero { 
            width: 100%; height: 250px; 
            position: relative; 
            overflow: hidden;
        }
        .detail-hero img { width: 100%; height: 100%; object-fit: cover; }
        .detail-hero::after {
            content: ''; position: absolute; bottom: 0; left: 0; width: 100%; height: 50%;
            background: linear-gradient(to top, #15151e, transparent);
        }
        .btn-play-hero {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 60px; height: 60px; background: rgba(255, 75, 75, 0.9);
            border-radius: 50%; display: flex; justify-content: center; align-items: center;
            font-size: 24px; color: white; box-shadow: 0 0 20px rgba(255, 75, 75, 0.5);
            z-index: 2; cursor: pointer; transition: transform 0.2s;
        }
        .btn-play-hero:active { transform: translate(-50%, -50%) scale(0.9); }

        /* Contenido del Modal */
        .detail-content { padding: 25px; margin-top: -20px; position: relative; z-index: 3; }
        .detail-title { font-size: 26px; font-weight: 800; margin: 0 0 8px 0; line-height: 1.1; }
        .detail-meta { font-size: 13px; color: #aaa; margin-bottom: 15px; display: flex; gap: 10px; align-items: center; }
        .tag-hd { border: 1px solid #aaa; padding: 1px 4px; border-radius: 3px; font-size: 10px; }
        .detail-desc { font-size: 14px; color: #ddd; line-height: 1.6; margin-bottom: 25px; }

        /* Botones de Acci贸n */
        .action-row { display: flex; gap: 12px; }
        .btn-main {
            flex: 1; padding: 14px; border: none; border-radius: 12px;
            font-size: 15px; font-weight: 600; cursor: pointer; display: flex; 
            align-items: center; justify-content: center; gap: 8px;
        }
        .btn-primary { background: white; color: black; }
        .btn-secondary { background: #2a2a35; color: white; }
        
        /* Bot贸n cerrar flotante */
        .btn-close-modal {
            position: absolute; top: 15px; right: 15px; z-index: 10;
            background: rgba(0,0,0,0.5); width: 30px; height: 30px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center; color: white;
            backdrop-filter: blur(4px); font-size: 14px; cursor: pointer;
        }

        /* --- NAV --- */
        .bottom-nav { position: fixed; bottom: 0; width: 100%; background: #0f0f1a; display: flex; justify-content: space-around; padding: 12px 0 25px 0; z-index: 300; border-top: 1px solid rgba(255,255,255,0.05); }
        .nav-item { text-align: center; color: #666; font-size: 10px; flex: 1; }
        .nav-item.active { color: var(--primary); }
        .nav-item i { font-size: 20px; margin-bottom: 5px; display: block; }

        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

    <div id="tab-home">
        <div class="header">
            <h2 class="logo">Flechazo TV</h2>
            <i class="fa-regular fa-bell" style="font-size: 20px;"></i>
        </div>

        <div class="section-title"> Tendencias</div>
        <div class="horizontal-scroll" id="home-list">
            <div style="padding:20px; color:#666;">Cargando...</div>
        </div>
        
        <div class="section-title">锔 Acci贸n y Free Fire</div>
        <div class="horizontal-scroll" id="action-list"></div>
    </div>

    <div class="modal-overlay" id="detail-modal" onclick="if(event.target.id==='detail-modal') closeModal()">
        <div class="modal-sheet">
            <div id="modal-injector"></div>
        </div>
    </div>

    <nav class="bottom-nav">
        <div class="nav-item active"><i class="fa-solid fa-house"></i>Inicio</div>
        <div class="nav-item"><i class="fa-solid fa-compass"></i>Explorar</div>
        <div class="nav-item"><i class="fa-brands fa-tiktok"></i>Shorts</div>
        <div class="nav-item"><i class="fa-solid fa-user"></i>Perfil</div>
    </nav>

    <script>
        // --- VARIABLES GLOBALES ---
        let allMovies = []; // Aqu铆 guardaremos lo que venga de la API

        // --- INICIALIZAR ---
        async function init() {
            try {
                // INTENTO CARGAR DE LA API
                const res = await fetch('http://localhost:3000/api/movies');
                if(!res.ok) throw new Error("API Offline");
                allMovies = await res.json();
            } catch (e) {
                console.warn("Usando datos de respaldo (API offline)");
                // DATOS DE RESPALDO (Por si no tienes el servidor prendido)
                allMovies = [
                    { id: 1, title: "Amor Prohibido", desc: "El amor entre dos mundos opuestos.", img: "https://image.tmdb.org/t/p/w300/6tfT03sGp9k4c0J3dypjrI8TSAI.jpg", cat: "Romance" },
                    { id: 2, title: "Free Fire: Booyah", desc: "La batalla real comienza ahora.", img: "https://image.tmdb.org/t/p/w300/rweIrveL43TaxUN0akQEaAXL6x0.jpg", cat: "Acci贸n" },
                    { id: 3, title: "Venganza Mortal", desc: "Nadie escapa de su pasado.", img: "https://image.tmdb.org/t/p/w300/fiVW06jE7z9YnO4trhaMEdclSiC.jpg", cat: "Acci贸n" },
                    { id: 4, title: "El Hacker", desc: "C贸digo rojo en la red.", img: "https://image.tmdb.org/t/p/w300/1E5baAaEse26fej7uHcjOgEE2t2.jpg", cat: "Suspenso" }
                ];
            }
            renderApp();
        }

        // --- RENDERIZAR LISTAS ---
        function renderApp() {
            const hList = document.getElementById('home-list');
            const aList = document.getElementById('action-list');
            hList.innerHTML = ''; aList.innerHTML = '';

            allMovies.forEach(m => {
                const card = `
                <div class="poster-card" onclick="openDetail(${m.id})">
                    <img src="${m.img}">
                </div>`;
                
                hList.innerHTML += card;
                if(m.cat === 'Acci贸n' || m.cat === 'Free Fire') aList.innerHTML += card;
            });
        }

        // --- FUNCIN DEL MODAL (LA PARTE QUE SE VEA FEA, AHORA ARREGLADA) ---
        window.openDetail = (id) => {
            const m = allMovies.find(x => x.id === id);
            if(!m) return;

            const injector = document.getElementById('modal-injector');
            
            // HTML DISEADO PARA VERSE BIEN
            injector.innerHTML = `
                <div class="detail-hero" onclick="alert('Reproduciendo ${m.title}')">
                    <img src="${m.img}">
                    <div class="btn-close-modal" onclick="event.stopPropagation(); closeModal()">
                        <i class="fa-solid fa-xmark"></i>
                    </div>
                    <div class="btn-play-hero">
                        <i class="fa-solid fa-play"></i>
                    </div>
                </div>

                <div class="detail-content">
                    <h2 class="detail-title">${m.title}</h2>
                    <div class="detail-meta">
                        <span style="color:#46d369; font-weight:bold;">98% Match</span>
                        <span>2024</span>
                        <span class="tag-hd">HD</span>
                        <span>${m.cat}</span>
                    </div>
                    
                    <p class="detail-desc">${m.desc}</p>

                    <div class="action-row">
                        <button class="btn-main btn-primary" onclick="alert('Reproduciendo...')">
                            <i class="fa-solid fa-play"></i> Ver Ahora
                        </button>
                        <button class="btn-main btn-secondary">
                            <i class="fa-solid fa-plus"></i> Mi Lista
                        </button>
                    </div>
                </div>
            `;

            document.getElementById('detail-modal').classList.add('open');
        }

        window.closeModal = () => {
            document.getElementById('detail-modal').classList.remove('open');
        }

        // ARRANCAR
        init();
    </script>
</body>
</html>
